import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { GFieldValidatorType } from '../../gs-forms.enums';
import { LOCATION } from '../../gs-forms.constants';
import { GsGenericFieldComponent } from '../_generic-field/_generic-field.component';
var GsCurrencyInputComponent = /** @class */ (function (_super) {
    tslib_1.__extends(GsCurrencyInputComponent, _super);
    function GsCurrencyInputComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.value = '';
        _this.fieldValidatorType = GFieldValidatorType;
        return _this;
    }
    GsCurrencyInputComponent.prototype.ngOnChanges = function (changes) {
        var location = null;
        if (changes.field && changes.field.currentValue.config.country) {
            location = LOCATION[changes.field.currentValue.config.country];
        }
        else if (changes.countryGlobal && changes.countryGlobal.currentValue) {
            location = LOCATION[changes.countryGlobal.currentValue];
        }
        else {
            return this.returnBuildingError();
        }
        this.prefix = location.currencyFormat.symbol;
        this.suffix = location.currencyFormat.code;
        this.thousandsSeparator = location.currencyFormat.thousands;
        this.decimalSeparator = location.currencyFormat.decimal;
        this.precision = location.currencyFormat.precision;
        if (changes.field.currentValue.config.value) {
            this.value = changes.field.currentValue.config.value.toString().replace('.', '');
        }
        this.formatCurrency(false);
    };
    GsCurrencyInputComponent.prototype.formatCurrency = function (keyup) {
        var _this = this;
        var inputVal = this.value || '0';
        // mark input as dirty
        if (keyup) {
            this.formGroup.controls[this.field.config.model].markAsDirty();
        }
        // remove any leading zeros
        if (inputVal.substring(0, 1) === '0') {
            inputVal = inputVal.replace(/^[0|\D]*/, '');
        }
        // format decimal if applies
        if (!inputVal || inputVal.length === 1 && inputVal.substring(0, 1) === '0') {
            var emptyDecimals = '0';
            if (this.precision > 0) {
                for (var index = 0; index < this.precision; index++) {
                    emptyDecimals = emptyDecimals + '0';
                }
            }
            inputVal = emptyDecimals;
        }
        var cleanValue = inputVal.replace(/\D/g, '');
        var decimals = null;
        var thousands = null;
        // format number as currency
        if (this.precision > 0) {
            decimals = cleanValue.slice(this.precision - this.precision * 2);
            if (decimals.length < this.precision) {
                for (var index = 0; index < this.precision - Number(decimals); index++) {
                    decimals = '0' + decimals;
                }
                thousands = '0';
            }
            else {
                thousands = cleanValue.substring(0, cleanValue.length - this.precision) || '0';
            }
        }
        else {
            thousands = cleanValue;
        }
        var formattedThousands = thousands.replace(/\D/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, this.thousandsSeparator);
        var controlValue = "" + thousands + (decimals ? '.' + decimals : '');
        this.value = formattedThousands + (decimals ? this.decimalSeparator + decimals : '');
        setTimeout(function () {
            _this.formGroup.controls[_this.field.config.model].patchValue(Number(controlValue));
            _this.formGroup.controls[_this.field.config.model].updateValueAndValidity();
        });
    };
    GsCurrencyInputComponent.prototype.returnBuildingError = function () {
        return console.error('GS Form building err: Please provide country for currency field:' + '\n\n' +
            'In your component make sure you are passing a valid country to `GCurrencyField`:' + '\n\n' +
            '\xa0' + 'public formFields: GFormFields = [' + '\n' +
            '\xa0\xa0' + 'new GCurrencyField({' + '\n' +
            '\xa0\xa0\xa0' + "model: 'currency'," + '\n' +
            '\xa0\xa0\xa0' + "country: GFieldCountryCode.CO" + '\n' +
            '\xa0\xa0\xa0' + '// other properties' + '\n' +
            '\xa0\xa0' + '}),' + '\n' +
            '\xa0' + '];' + '\n\n' +
            'Or In your component make sure you are passing a valid country to `GFormOptions`:' + '\n\n' +
            '\xa0' + 'public formOptions: GFormOptions = {' + '\n' +
            '\xa0\xa0' + 'country: GFieldCountryCode.CO' + '\n' +
            '\xa0\xa0' + '// other properties' + '\n' +
            '\xa0' + '};' + '\n\n');
    };
    tslib_1.__decorate([
        Input()
    ], GsCurrencyInputComponent.prototype, "field", void 0);
    tslib_1.__decorate([
        Input()
    ], GsCurrencyInputComponent.prototype, "countryGlobal", void 0);
    GsCurrencyInputComponent = tslib_1.__decorate([
        Component({
            selector: 'gs-currency-input',
            template: "<ng-container>\n  <div\n    class=\"gs-field\" \n    [class.gs-field-has-error]=\"validateField()\">\n    \n    <label\n      class=\"gs-field-box\"\n      [class.gs-form-field-box-full]=\"field.config.label\">\n  \n      <span\n        class=\"gs-field-label\"\n        *ngIf=\"field.config.label\">\n        {{ field.config.label | translate }}\n      </span>\n  \n      <div class=\"gs-field-currency\">\n        <span class=\"gs-field-currency-symbol\">{{ prefix }}</span>\n        <input\n          #inputElement\n          class=\"gs-field-input gs-field-currency-input\"\n          type=\"text\"\n          [autocomplete]=\"field.config.autocomplete || 'off'\"\n          [id]=\"field.config.model\"\n          [placeholder]=\"field.config.placeholder || field.config.label || field.config.model | translate\"\n          [(ngModel)]=\"value\"\n          (keyup)=\"formatCurrency(true)\" />\n        <span class=\"gs-field-currency-code\">{{ suffix }}</span>\n      </div>\n    </label>\n\n    <span class=\"gs-field-error\" *ngIf=\"validateField()\">\n      {{ getFieldError(field.config.model) | translate }}\n    </span>\n  </div>\n</ng-container>\n",
            styles: ["*{color:var(--gs-color-font,#706967);outline:0;box-sizing:border-box}input,option,select,textarea{border:none;outline:0;display:block;box-shadow:none;box-sizing:border-box}input::-webkit-input-placeholder,option::-webkit-input-placeholder,select::-webkit-input-placeholder,textarea::-webkit-input-placeholder{opacity:.5}input::-moz-placeholder,option::-moz-placeholder,select::-moz-placeholder,textarea::-moz-placeholder{opacity:.5}input::-ms-input-placeholder,option::-ms-input-placeholder,select::-ms-input-placeholder,textarea::-ms-input-placeholder{opacity:.5}input::placeholder,option::placeholder,select::placeholder,textarea::placeholder{opacity:.5}.disabled{opacity:var(--gs-disabled-opacity,.7);cursor:default;pointer-events:none}.button{-webkit-transition:.2s ease-in-out;transition:.2s ease-in-out;cursor:pointer;border:none;text-align:center;font-weight:700;outline:0;padding:var(--gs-primary-button-padding,1rem);color:var(--gs-primary-button-color,#fff);background:var(--gs-primary-button-background,#b8b4b4);border-radius:var(--gs-primary-button-border-radius,1rem)}.button:hover{opacity:.8}.button.button-primary{padding:var(--gs-primary-button-padding,1rem);color:var(--gs-primary-button-color,#fff);background:var(--gs-primary-button-background,#ff2426);border:none;border-radius:var(--gs-primary-button-border-radius,1rem)}.button.button-secondary{padding:var(--gs-primary-button-padding,1rem);color:var(--gs-primary-button-background,#ff2426);background:0 0;border:2px solid var(--gs-primary-button-background,#ff2426);border-radius:var(--gs-primary-button-border-radius,1rem)}*,input,select,textarea{font-size:var(--gs-font-size,.9rem);font-family:inherit;background-color:transparent}.gs-no-select{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gs-field{position:relative}.gs-field.gs-field-has-error .gs-field-box{border:2px solid #ff2426}.gs-field.gs-field-has-error .gs-field-error{display:block}.gs-field-box{border:2px solid var(--gs-input-border-color,none);display:-ms-grid;display:grid;background-color:var(--gs-input-background,#fff);padding:var(--gs-input-padding,12px);border-radius:var(--gs-input-border-radius,1rem);height:51px}.gs-field-box .gs-field-label{color:#706967;font-size:.6rem;font-weight:600;letter-spacing:.1em;line-height:1;text-transform:uppercase;-ms-grid-column:1;grid-column:1;-ms-grid-row:1;grid-row:1;color:var(--gs-input-color,#332927);opacity:.5}.gs-field-box .gs-field-input{outline:0;border:none;width:100%;margin:0;font-weight:600;font-size:1rem;line-height:1;padding:0;-ms-grid-column:1;grid-column:1;-ms-grid-row:2;grid-row:2}.gs-field-box .gs-field-input :focus,.gs-field-box .gs-field-input:focus{outline:0}.gs-field-box .gs-field-input::-webkit-input-placeholder{color:var(--gs-input-color,#332927);opacity:.7;font-weight:400}.gs-field-box .gs-field-input::-moz-placeholder{color:var(--gs-input-color,#332927);opacity:.7;font-weight:400}.gs-field-box .gs-field-input::-ms-input-placeholder{color:var(--gs-input-color,#332927);opacity:.7;font-weight:400}.gs-field-box .gs-field-input::placeholder{color:var(--gs-input-color,#332927);opacity:.7;font-weight:400}.gs-field-box .gs-form-field_symbol{-ms-grid-column:2;grid-column:2;-ms-grid-row:1;-ms-grid-row-span:2;grid-row:1/3;-ms-grid-row-align:center;align-self:center;text-align:right}.gs-field-box.gs-field-box-full .gs-field-input{padding:.1rem 0 0}.gs-field-box.gs-input-check-box,.gs-field-box.gs-input-switch-box{-ms-grid-columns:1fr auto;grid-template-columns:1fr auto}.gs-field-box.gs-input-check-box .gs-field-label,.gs-field-box.gs-input-switch-box .gs-field-label{-ms-grid-column:1;grid-column:1;-ms-grid-row:1;grid-row:1;-ms-grid-row-align:center;align-self:center}.gs-field-box.gs-input-check-box .gs-input-check,.gs-field-box.gs-input-check-box .gs-input-switch,.gs-field-box.gs-input-switch-box .gs-input-check,.gs-field-box.gs-input-switch-box .gs-input-switch{-ms-grid-column:2;grid-column:2;-ms-grid-row:1;grid-row:1;-ms-grid-row-align:center;align-self:center}.gs-field-box.gs-field-box-icon{display:-ms-grid;display:grid;-ms-grid-columns:1fr 20px;grid-template-columns:1fr 20px}.gs-field-box.gs-field-box-icon .gs-field-icon{cursor:pointer;width:20px;fill:#706967;-ms-grid-column:2;grid-column:2;-ms-grid-row:1;-ms-grid-row-span:2;grid-row:1/3;-ms-grid-row-align:center;align-self:center}.gs-field-error,.gs-field-hint{font-size:.8rem;padding:.6rem 1rem;display:inline-block;margin-right:1rem}.gs-field-error{display:none;color:#ff2426}.gs-field-currency{display:-ms-grid;display:grid;-ms-grid-columns:-webkit-min-content auto -webkit-min-content;-ms-grid-columns:min-content auto min-content;grid-template-columns:-webkit-min-content auto -webkit-min-content;grid-template-columns:min-content auto min-content}.gs-field-currency .gs-field-currency-input{background:0 0;border:none;outline:0;text-align:right;padding-right:.5rem;grid-row:unset;grid-column:unset}.gs-field-currency .gs-field-currency-code,.gs-field-currency .gs-field-currency-symbol{-ms-grid-row-align:center;align-self:center}"]
        })
    ], GsCurrencyInputComponent);
    return GsCurrencyInputComponent;
}(GsGenericFieldComponent));
export { GsCurrencyInputComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3VycmVuY3ktaW5wdXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzL25nLWZvcm1zLyIsInNvdXJjZXMiOlsibGliL2dzLWZpZWxkcy9jdXJyZW5jeS1pbnB1dC9jdXJyZW5jeS1pbnB1dC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUUzRSxPQUFPLEVBQUUsbUJBQW1CLEVBQXFCLE1BQU0sc0JBQXNCLENBQUM7QUFDOUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3BELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBT3JGO0lBQThDLG9EQUF1QjtJQUxyRTtRQUFBLHFFQTJIQztRQS9HUSxXQUFLLEdBQUcsRUFBRSxDQUFDO1FBTVgsd0JBQWtCLEdBQUcsbUJBQW1CLENBQUM7O0lBeUdsRCxDQUFDO0lBdkdDLDhDQUFXLEdBQVgsVUFBWSxPQUFzQjtRQUNoQyxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFFcEIsSUFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUU7WUFDOUQsUUFBUSxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7U0FFaEU7YUFBTSxJQUFJLE9BQU8sQ0FBQyxhQUFhLElBQUksT0FBTyxDQUFDLGFBQWEsQ0FBQyxZQUFZLEVBQUU7WUFDdEUsUUFBUSxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBRXpEO2FBQU07WUFDTCxPQUFPLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1NBQ25DO1FBRUQsSUFBSSxDQUFDLE1BQU0sR0FBRyxRQUFR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R0FBRyxJQUFJO1lBQ3ZELGNBQWMsR0FBRyxxQkFBcUIsR0FBRyxJQUFJO1lBQzdDLFVBQVUsR0FBRyxLQUFLLEdBQUcsSUFBSTtZQUN6QixNQUFNLEdBQUcsSUFBSSxHQUFHLE1BQU07WUFDdEIsbUZBQW1GLEdBQUcsTUFBTTtZQUM1RixNQUFNLEdBQUcsc0NBQXNDLEdBQUcsSUFBSTtZQUN0RCxVQUFVLEdBQUcsK0JBQStCLEdBQUcsSUFBSTtZQUNuRCxVQUFVLEdBQUcscUJBQXFCLEdBQUcsSUFBSTtZQUN6QyxNQUFNLEdBQUcsSUFBSSxHQUFHLE1BQU0sQ0FDdkIsQ0FBQztJQUNKLENBQUM7SUFuSFE7UUFBUixLQUFLLEVBQUU7MkRBQThCO0lBQzdCO1FBQVIsS0FBSyxFQUFFO21FQUEwQztJQUZ2Qyx3QkFBd0I7UUFMcEMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLG1CQUFtQjtZQUM3QixrcENBQThDOztTQUUvQyxDQUFDO09BQ1csd0JBQXdCLENBc0hwQztJQUFELCtCQUFDO0NBQUEsQUF0SEQsQ0FBOEMsdUJBQXVCLEdBc0hwRTtTQXRIWSx3QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEdDdXJyZW5jeUZpZWxkIH0gZnJvbSAnLi4vLi4vZ3MtZm9ybXMud2lkZ2V0cyc7XG5pbXBvcnQgeyBHRmllbGRWYWxpZGF0b3JUeXBlLCBHRmllbGRDb3VudHJ5Q29kZSB9IGZyb20gJy4uLy4uL2dzLWZvcm1zLmVudW1zJztcbmltcG9ydCB7IExPQ0FUSU9OIH0gZnJvbSAnLi4vLi4vZ3MtZm9ybXMuY29uc3RhbnRzJztcbmltcG9ydCB7IEdzR2VuZXJpY0ZpZWxkQ29tcG9uZW50IH0gZnJvbSAnLi4vX2dlbmVyaWMtZmllbGQvX2dlbmVyaWMtZmllbGQuY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZ3MtY3VycmVuY3ktaW5wdXQnLFxuICB0ZW1wbGF0ZVVybDogJy4vY3VycmVuY3ktaW5wdXQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9jdXJyZW5jeS1pbnB1dC5jb21wb25lbnQuc2FzcyddXG59KVxuZXhwb3J0IGNsYXNzIEdzQ3VycmVuY3lJbnB1dENvbXBvbmVudCBleHRlbmRzIEdzR2VuZXJpY0ZpZWxkQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgQElucHV0KCkgcHVibGljIGZpZWxkOiBHQ3VycmVuY3lGaWVsZDtcbiAgQElucHV0KCkgcHJpdmF0ZSBjb3VudHJ5R2xvYmFsOiBHRmllbGRDb3VudHJ5Q29kZTtcblxuICBwdWJsaWMgcGF0dGVybjogc3RyaW5nIHwgUmVnRXhwO1xuICBwdWJsaWMgcHJlZml4OiBzdHJpbmc7XG4gIHB1YmxpYyBzdWZmaXg6IHN0cmluZztcbiAgcHVibGljIHZhbHVlID0gJyc7XG5cbiAgcHJpdmF0ZSB0aG91c2FuZHNTZXBhcmF0b3I6IHN0cmluZztcbiAgcHJpdmF0ZSBkZWNpbWFsU2VwYXJhdG9yOiBzdHJpbmc7XG4gIHByaXZhdGUgcHJlY2lzaW9uOiBudW1iZXI7XG5cbiAgcHVibGljIGZpZWxkVmFsaWRhdG9yVHlwZSA9IEdGaWVsZFZhbGlkYXRvclR5cGU7XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGxldCBsb2NhdGlvbiA9IG51bGw7XG5cbiAgICBpZiAoY2hhbmdlcy5maWVsZCAmJiBjaGFuZ2VzLmZpZWxkLmN1cnJlbnRWYWx1ZS5jb25maWcuY291bnRyeSkge1xuICAgICAgbG9jYXRpb24gPSBMT0NBVElPTltjaGFuZ2VzLmZpZWxkLmN1cnJlbnRWYWx1ZS5jb25maWcuY291bnRyeV07XG5cbiAgICB9IGVsc2UgaWYgKGNoYW5nZXMuY291bnRyeUdsb2JhbCAmJiBjaGFuZ2VzLmNvdW50cnlHbG9iYWwuY3VycmVudFZhbHVlKSB7XG4gICAgICBsb2NhdGlvbiA9IExPQ0FUSU9OW2NoYW5nZXMuY291bnRyeUdsb2JhbC5jdXJyZW50VmFsdWVdO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnJldHVybkJ1aWxkaW5nRXJyb3IoKTtcbiAgICB9XG5cbiAgICB0aGlzLnByZWZpeCA9IGxvY2F0aW9uLmN1cnJlbmN5Rm9ybWF0LnN5bWJvbDtcbiAgICB0aGlzLnN1ZmZpeCA9IGxvY2F0aW9uLmN1cnJlbmN5Rm9ybWF0LmNvZGU7XG4gICAgdGhpcy50aG91c2FuZHNTZXBhcmF0b3IgPSBsb2NhdGlvbi5jdXJyZW5jeUZvcm1hdC50aG91c2FuZHM7XG4gICAgdGhpcy5kZWNpbWFsU2VwYXJhdG9yID0gbG9jYXRpb24uY3VycmVuY3lGb3JtYXQuZGVjaW1hbDtcbiAgICB0aGlzLnByZWNpc2lvbiA9IGxvY2F0aW9uLmN1cnJlbmN5Rm9ybWF0LnByZWNpc2lvbjtcblxuICAgIGlmIChjaGFuZ2VzLmZpZWxkLmN1cnJlbnRWYWx1ZS5jb25maWcudmFsdWUpIHtcbiAgICAgIHRoaXMudmFsdWUgPSBjaGFuZ2VzLmZpZWxkLmN1cnJlbnRWYWx1ZS5jb25maWcudmFsdWUudG9TdHJpbmcoKS5yZXBsYWNlKCcuJywgJycpO1xuICAgIH1cblxuICAgIHRoaXMuZm9ybWF0Q3VycmVuY3koZmFsc2UpO1xuICB9XG5cbiAgcHVibGljIGZvcm1hdEN1cnJlbmN5KGtleXVwOiBib29sZWFuKSB7XG4gICAgbGV0IGlucHV0VmFsID0gdGhpcy52YWx1ZSB8fCAnMCc7XG5cbiAgICAvLyBtYXJrIGlucHV0IGFzIGRpcnR5XG4gICAgaWYgKGtleXVwKSB7XG4gICAgICB0aGlzLmZvcm1Hcm91cC5jb250cm9sc1t0aGlzLmZpZWxkLmNvbmZpZy5tb2RlbF0ubWFya0FzRGlydHkoKTtcbiAgICB9XG5cbiAgICAvLyByZW1vdmUgYW55IGxlYWRpbmcgemVyb3NcbiAgICBpZiAoaW5wdXRWYWwuc3Vic3RyaW5nKDAsIDEpID09PSAnMCcpIHtcbiAgICAgIGlucHV0VmFsID0gaW5wdXRWYWwucmVwbGFjZSgvXlswfFxcRF0qLywgJycpO1xuICAgIH1cblxuICAgIC8vIGZvcm1hdCBkZWNpbWFsIGlmIGFwcGxpZXNcbiAgICBpZiAoIWlucHV0VmFsIHx8IGlucHV0VmFsLmxlbmd0aCA9PT0gMSAmJiBpbnB1dFZhbC5zdWJzdHJpbmcoMCwgMSkgPT09ICcwJykge1xuICAgICAgbGV0IGVtcHR5RGVjaW1hbHMgPSAnMCc7XG5cbiAgICAgIGlmICh0aGlzLnByZWNpc2lvbiA+IDApIHtcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMucHJlY2lzaW9uOyBpbmRleCsrKSB7XG4gICAgICAgICAgZW1wdHlEZWNpbWFscyA9IGVtcHR5RGVjaW1hbHMgKyAnMCc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlucHV0VmFsID0gZW1wdHlEZWNpbWFscztcbiAgICB9XG5cbiAgICBjb25zdCBjbGVhblZhbHVlID0gaW5wdXRWYWwucmVwbGFjZSgvXFxEL2csICcnKTtcblxuICAgIGxldCBkZWNpbWFscyA9IG51bGw7XG4gICAgbGV0IHRob3VzYW5kcyA9IG51bGw7XG5cbiAgICAvLyBmb3JtYXQgbnVtYmVyIGFzIGN1cnJlbmN5XG4gICAgaWYgKHRoaXMucHJlY2lzaW9uID4gMCkge1xuICAgICAgZGVjaW1hbHMgPSBjbGVhblZhbHVlLnNsaWNlKHRoaXMucHJlY2lzaW9uIC0gdGhpcy5wcmVjaXNpb24gKiAyKTtcblxuICAgICAgaWYgKGRlY2ltYWxzLmxlbmd0aCA8IHRoaXMucHJlY2lzaW9uKSB7XG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLnByZWNpc2lvbiAtIE51bWJlcihkZWNpbWFscyk7IGluZGV4KyspIHtcbiAgICAgICAgICBkZWNpbWFscyA9ICcwJyArIGRlY2ltYWxzO1xuICAgICAgICB9XG4gICAgICAgIHRob3VzYW5kcyA9ICcwJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRob3VzYW5kcyA9IGNsZWFuVmFsdWUuc3Vic3RyaW5nKDAsIGNsZWFuVmFsdWUubGVuZ3RoIC0gdGhpcy5wcmVjaXNpb24pIHx8ICcwJztcbiAgICAgIH1cblxuICAgIH0gZWxzZSB7XG4gICAgICB0aG91c2FuZHMgPSBjbGVhblZhbHVlO1xuICAgIH1cblxuICAgIGNvbnN0IGZvcm1hdHRlZFRob3VzYW5kcyA9IHRob3VzYW5kcy5yZXBsYWNlKC9cXEQvZywgJycpLnJlcGxhY2UoL1xcQig/PShcXGR7M30pKyg/IVxcZCkpL2csIHRoaXMudGhvdXNhbmRzU2VwYXJhdG9yKTtcbiAgICBjb25zdCBjb250cm9sVmFsdWUgPSBgJHt0aG91c2FuZHN9JHtkZWNpbWFscyA/ICcuJyArIGRlY2ltYWxzIDogJyd9YDtcblxuICAgIHRoaXMudmFsdWUgPSBmb3JtYXR0ZWRUaG91c2FuZHMgKyAoZGVjaW1hbHMgPyB0aGlzLmRlY2ltYWxTZXBhcmF0b3IgKyBkZWNpbWFscyA6ICcnKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5mb3JtR3JvdXAuY29udHJvbHNbdGhpcy5maWVsZC5jb25maWcubW9kZWxdLnBhdGNoVmFsdWUoTnVtYmVyKGNvbnRyb2xWYWx1ZSkpO1xuICAgICAgdGhpcy5mb3JtR3JvdXAuY29udHJvbHNbdGhpcy5maWVsZC5jb25maWcubW9kZWxdLnVwZGF0ZVZhbHVlQW5kVmFsaWRpdHkoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyByZXR1cm5CdWlsZGluZ0Vycm9yKCkge1xuICAgIHJldHVybiBjb25zb2xlLmVycm9yKFxuICAgICAgJ0dTIEZvcm0gYnVpbGRpbmcgZXJyOiBQbGVhc2UgcHJvdmlkZSBjb3VudHJ5IGZvciBjdXJyZW5jeSBmaWVsZDonICsgJ1xcblxcbicgK1xuICAgICAgJ0luIHlvdXIgY29tcG9uZW50IG1ha2Ugc3VyZSB5b3UgYXJlIHBhc3NpbmcgYSB2YWxpZCBjb3VudHJ5IHRvIGBHQ3VycmVuY3lGaWVsZGA6JyArICdcXG5cXG4nICtcbiAgICAgICdcXHhhMCcgKyAncHVibGljIGZvcm1GaWVsZHM6IEdGb3JtRmllbGRzID0gWycgKyAnXFxuJyArXG4gICAgICAnXFx4YTBcXHhhMCcgKyAnbmV3IEdDdXJyZW5jeUZpZWxkKHsnICsgJ1xcbicgK1xuICAgICAgJ1xceGEwXFx4YTBcXHhhMCcgKyBgbW9kZWw6ICdjdXJyZW5jeScsYCArICdcXG4nICtcbiAgICAgICdcXHhhMFxceGEwXFx4YTAnICsgYGNvdW50cnk6IEdGaWVsZENvdW50cnlDb2RlLkNPYCArICdcXG4nICtcbiAgICAgICdcXHhhMFxceGEwXFx4YTAnICsgJy8vIG90aGVyIHByb3BlcnRpZXMnICsgJ1xcbicgK1xuICAgICAgJ1xceGEwXFx4YTAnICsgJ30pLCcgKyAnXFxuJyArXG4gICAgICAnXFx4YTAnICsgJ107JyArICdcXG5cXG4nICtcbiAgICAgICdPciBJbiB5b3VyIGNvbXBvbmVudCBtYWtlIHN1cmUgeW91IGFyZSBwYXNzaW5nIGEgdmFsaWQgY291bnRyeSB0byBgR0Zvcm1PcHRpb25zYDonICsgJ1xcblxcbicgK1xuICAgICAgJ1xceGEwJyArICdwdWJsaWMgZm9ybU9wdGlvbnM6IEdGb3JtT3B0aW9ucyA9IHsnICsgJ1xcbicgK1xuICAgICAgJ1xceGEwXFx4YTAnICsgJ2NvdW50cnk6IEdGaWVsZENvdW50cnlDb2RlLkNPJyArICdcXG4nICtcbiAgICAgICdcXHhhMFxceGEwJyArICcvLyBvdGhlciBwcm9wZXJ0aWVzJyArICdcXG4nICtcbiAgICAgICdcXHhhMCcgKyAnfTsnICsgJ1xcblxcbidcbiAgICApO1xuICB9XG5cbn1cbiJdfQ==