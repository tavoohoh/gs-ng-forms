import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { GFieldValidatorType } from '../../gs-forms.enums';
import { LOCATION } from '../../gs-forms.constants';
import { GsGenericFieldComponent } from '../_generic-field/_generic-field.component';
let GsCurrencyInputComponent = class GsCurrencyInputComponent extends GsGenericFieldComponent {
    constructor() {
        super(...arguments);
        this.value = '';
        this.fieldValidatorType = GFieldValidatorType;
    }
    ngOnChanges(changes) {
        let location = null;
        if (changes.field && changes.field.currentValue.config.country) {
            location = LOCATION[changes.field.currentValue.config.country];
        }
        else if (changes.countryGlobal && changes.countryGlobal.currentValue) {
            location = LOCATION[changes.countryGlobal.currentValue];
        }
        else {
            return this.returnBuildingError();
        }
        this.prefix = location.currencyFormat.symbol;
        this.suffix = location.currencyFormat.code;
        this.thousandsSeparator = location.currencyFormat.thousands;
        this.decimalSeparator = location.currencyFormat.decimal;
        this.precision = location.currencyFormat.precision;
        if (changes.field.currentValue.config.value) {
            this.value = changes.field.currentValue.config.value.toString().replace('.', '');
        }
        this.formatCurrency(false);
    }
    formatCurrency(keyup) {
        let inputVal = this.value || '0';
        // mark input as dirty
        if (keyup) {
            this.formGroup.controls[this.field.config.model].markAsDirty();
        }
        // remove any leading zeros
        if (inputVal.substring(0, 1) === '0') {
            inputVal = inputVal.replace(/^[0|\D]*/, '');
        }
        // format decimal if applies
        if (!inputVal || inputVal.length === 1 && inputVal.substring(0, 1) === '0') {
            let emptyDecimals = '0';
            if (this.precision > 0) {
                for (let index = 0; index < this.precision; index++) {
                    emptyDecimals = emptyDecimals + '0';
                }
            }
            inputVal = emptyDecimals;
        }
        const cleanValue = inputVal.replace(/\D/g, '');
        let decimals = null;
        let thousands = null;
        // format number as currency
        if (this.precision > 0) {
            decimals = cleanValue.slice(this.precision - this.precision * 2);
            if (decimals.length < this.precision) {
                for (let index = 0; index < this.precision - Number(decimals); index++) {
                    decimals = '0' + decimals;
                }
                thousands = '0';
            }
            else {
                thousands = cleanValue.substring(0, cleanValue.length - this.precision) || '0';
            }
        }
        else {
            thousands = cleanValue;
        }
        const formattedThousands = thousands.replace(/\D/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, this.thousandsSeparator);
        const controlValue = `${thousands}${decimals ? '.' + decimals : ''}`;
        this.value = formattedThousands + (decimals ? this.decimalSeparator + decimals : '');
        setTimeout(() => {
            this.formGroup.controls[this.field.config.model].patchValue(Number(controlValue));
            this.formGroup.controls[this.field.config.model].updateValueAndValidity();
        });
    }
    returnBuildingError() {
        return console.error('GS Form building err: Please provide country for currency field:' + '\n\n' +
            'In your component make sure you are passing a valid country to `GCurrencyField`:' + '\n\n' +
            '\xa0' + 'public formFields: GFormFields = [' + '\n' +
            '\xa0\xa0' + 'new GCurrencyField({' + '\n' +
            '\xa0\xa0\xa0' + `model: 'currency',` + '\n' +
            '\xa0\xa0\xa0' + `country: GFieldCountryCode.CO` + '\n' +
            '\xa0\xa0\xa0' + '// other properties' + '\n' +
            '\xa0\xa0' + '}),' + '\n' +
            '\xa0' + '];' + '\n\n' +
            'Or In your component make sure you are passing a valid country to `GFormOptions`:' + '\n\n' +
            '\xa0' + 'public formOptions: GFormOptions = {' + '\n' +
            '\xa0\xa0' + 'country: GFieldCountryCode.CO' + '\n' +
            '\xa0\xa0' + '// other properties' + '\n' +
            '\xa0' + '};' + '\n\n');
    }
};
tslib_1.__decorate([
    Input()
], GsCurrencyInputComponent.prototype, "field", void 0);
tslib_1.__decorate([
    Input()
], GsCurrencyInputComponent.prototype, "countryGlobal", void 0);
GsCurrencyInputComponent = tslib_1.__decorate([
    Component({
        selector: 'gs-currency-input',
        template: "<ng-container>\n  <div\n    class=\"gs-field\" \n    [class.gs-field-has-error]=\"validateField()\">\n    \n    <label\n      class=\"gs-field-box\"\n      [class.gs-form-field-box-full]=\"field.config.label\">\n  \n      <span\n        class=\"gs-field-label\"\n        *ngIf=\"field.config.label\">\n        {{ field.config.label | translate }}\n      </span>\n  \n      <div class=\"gs-field-currency\">\n        <span class=\"gs-field-currency-symbol\">{{ prefix }}</span>\n        <input\n          #inputElement\n          class=\"gs-field-input gs-field-currency-input\"\n          type=\"text\"\n          [autocomplete]=\"field.config.autocomplete || 'off'\"\n          [id]=\"field.config.model\"\n          [placeholder]=\"field.config.placeholder || field.config.label || field.config.model | translate\"\n          [(ngModel)]=\"value\"\n          (keyup)=\"formatCurrency(true)\" />\n        <span class=\"gs-field-currency-code\">{{ suffix }}</span>\n      </div>\n    </label>\n\n    <span class=\"gs-field-error\" *ngIf=\"validateField()\">\n      {{ getFieldError(field.config.model) | translate }}\n    </span>\n  </div>\n</ng-container>\n",
        styles: ["*{color:var(--gs-color-font,#706967);outline:0;box-sizing:border-box}input,option,select,textarea{border:none;outline:0;display:block;box-shadow:none;box-sizing:border-box}input::-webkit-input-placeholder,option::-webkit-input-placeholder,select::-webkit-input-placeholder,textarea::-webkit-input-placeholder{opacity:.5}input::-moz-placeholder,option::-moz-placeholder,select::-moz-placeholder,textarea::-moz-placeholder{opacity:.5}input::-ms-input-placeholder,option::-ms-input-placeholder,select::-ms-input-placeholder,textarea::-ms-input-placeholder{opacity:.5}input::placeholder,option::placeholder,select::placeholder,textarea::placeholder{opacity:.5}.disabled{opacity:var(--gs-disabled-opacity,.7);cursor:default;pointer-events:none}.button{-webkit-transition:.2s ease-in-out;transition:.2s ease-in-out;cursor:pointer;border:none;text-align:center;font-weight:700;outline:0;padding:var(--gs-primary-button-padding,1rem);color:var(--gs-primary-button-color,#fff);background:var(--gs-primary-button-background,#b8b4b4);border-radius:var(--gs-primary-button-border-radius,1rem)}.button:hover{opacity:.8}.button.button-primary{padding:var(--gs-primary-button-padding,1rem);color:var(--gs-primary-button-color,#fff);background:var(--gs-primary-button-background,#ff2426);border:none;border-radius:var(--gs-primary-button-border-radius,1rem)}.button.button-secondary{padding:var(--gs-primary-button-padding,1rem);color:var(--gs-primary-button-background,#ff2426);background:0 0;border:2px solid var(--gs-primary-button-background,#ff2426);border-radius:var(--gs-primary-button-border-radius,1rem)}*,input,select,textarea{font-size:var(--gs-font-size,.9rem);font-family:inherit;background-color:transparent}.gs-no-select{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gs-field{position:relative}.gs-field.gs-field-has-error .gs-field-box{border:2px solid #ff2426}.gs-field.gs-field-has-error .gs-field-error{display:block}.gs-field-box{border:2px solid var(--gs-input-border-color,none);display:-ms-grid;display:grid;background-color:var(--gs-input-background,#fff);padding:var(--gs-input-padding,12px);border-radius:var(--gs-input-border-radius,1rem);height:51px}.gs-field-box .gs-field-label{color:#706967;font-size:.6rem;font-weight:600;letter-spacing:.1em;line-height:1;text-transform:uppercase;-ms-grid-column:1;grid-column:1;-ms-grid-row:1;grid-row:1;color:var(--gs-input-color,#332927);opacity:.5}.gs-field-box .gs-field-input{outline:0;border:none;width:100%;margin:0;font-weight:600;font-size:1rem;line-height:1;padding:0;-ms-grid-column:1;grid-column:1;-ms-grid-row:2;grid-row:2}.gs-field-box .gs-field-input :focus,.gs-field-box .gs-field-input:focus{outline:0}.gs-field-box .gs-field-input::-webkit-input-placeholder{color:var(--gs-input-color,#332927);opacity:.7;font-weight:400}.gs-field-box .gs-field-input::-moz-placeholder{color:var(--gs-input-color,#332927);opacity:.7;font-weight:400}.gs-field-box .gs-field-input::-ms-input-placeholder{color:var(--gs-input-color,#332927);opacity:.7;font-weight:400}.gs-field-box .gs-field-input::placeholder{color:var(--gs-input-color,#332927);opacity:.7;font-weight:400}.gs-field-box .gs-form-field_symbol{-ms-grid-column:2;grid-column:2;-ms-grid-row:1;-ms-grid-row-span:2;grid-row:1/3;-ms-grid-row-align:center;align-self:center;text-align:right}.gs-field-box.gs-field-box-full .gs-field-input{padding:.1rem 0 0}.gs-field-box.gs-input-check-box,.gs-field-box.gs-input-switch-box{-ms-grid-columns:1fr auto;grid-template-columns:1fr auto}.gs-field-box.gs-input-check-box .gs-field-label,.gs-field-box.gs-input-switch-box .gs-field-label{-ms-grid-column:1;grid-column:1;-ms-grid-row:1;grid-row:1;-ms-grid-row-align:center;align-self:center}.gs-field-box.gs-input-check-box .gs-input-check,.gs-field-box.gs-input-check-box .gs-input-switch,.gs-field-box.gs-input-switch-box .gs-input-check,.gs-field-box.gs-input-switch-box .gs-input-switch{-ms-grid-column:2;grid-column:2;-ms-grid-row:1;grid-row:1;-ms-grid-row-align:center;align-self:center}.gs-field-box.gs-field-box-icon{display:-ms-grid;display:grid;-ms-grid-columns:1fr 20px;grid-template-columns:1fr 20px}.gs-field-box.gs-field-box-icon .gs-field-icon{cursor:pointer;width:20px;fill:#706967;-ms-grid-column:2;grid-column:2;-ms-grid-row:1;-ms-grid-row-span:2;grid-row:1/3;-ms-grid-row-align:center;align-self:center}.gs-field-error,.gs-field-hint{font-size:.8rem;padding:.6rem 1rem;display:inline-block;margin-right:1rem}.gs-field-error{display:none;color:#ff2426}.gs-field-currency{display:-ms-grid;display:grid;-ms-grid-columns:-webkit-min-content auto -webkit-min-content;-ms-grid-columns:min-content auto min-content;grid-template-columns:-webkit-min-content auto -webkit-min-content;grid-template-columns:min-content auto min-content}.gs-field-currency .gs-field-currency-input{background:0 0;border:none;outline:0;text-align:right;padding-right:.5rem;grid-row:unset;grid-column:unset}.gs-field-currency .gs-field-currency-code,.gs-field-currency .gs-field-currency-symbol{-ms-grid-row-align:center;align-self:center}"]
    })
], GsCurrencyInputComponent);
export { GsCurrencyInputComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3VycmVuY3ktaW5wdXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzL25nLWZvcm1zLyIsInNvdXJjZXMiOlsibGliL2dzLWZpZWxkcy9jdXJyZW5jeS1pbnB1dC9jdXJyZW5jeS1pbnB1dC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUUzRSxPQUFPLEVBQUUsbUJBQW1CLEVBQXFCLE1BQU0sc0JBQXNCLENBQUM7QUFDOUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3BELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBT3JGLElBQWEsd0JBQXdCLEdBQXJDLE1BQWEsd0JBQXlCLFNBQVEsdUJBQXVCO0lBTHJFOztRQVlTLFVBQUssR0FBRyxFQUFFLENBQUM7UUFNWCx1QkFBa0IsR0FBRyxtQkFBbUIsQ0FBQztJQXlHbEQsQ0FBQztJQXZHQyxXQUFXLENBQUMsT0FBc0I7UUFDaEMsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBRXBCLElBQUksT0FBTyxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFO1lBQzlELFFBQVEsR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBRWhFO2FBQU0sSUFBSSxPQUFPLENBQUMsYUFBYSxJQUFJLE9BQU8sQ0FBQyxhQUFhLENBQUMsWUFBWSxFQUFFO1lBQ3RFLFFBQVEsR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQztTQUV6RDthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztTQUNuQztRQUVELElBQUksQ0FBQyxNQUFN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QUFJO1lBQ3ZELGNBQWMsR0FBRyxxQkFBcUIsR0FBRyxJQUFJO1lBQzdDLFVBQVUsR0FBRyxLQUFLLEdBQUcsSUFBSTtZQUN6QixNQUFNLEdBQUcsSUFBSSxHQUFHLE1BQU07WUFDdEIsbUZBQW1GLEdBQUcsTUFBTTtZQUM1RixNQUFNLEdBQUcsc0NBQXNDLEdBQUcsSUFBSTtZQUN0RCxVQUFVLEdBQUcsK0JBQStCLEdBQUcsSUFBSTtZQUNuRCxVQUFVLEdBQUcscUJBQXFCLEdBQUcsSUFBSTtZQUN6QyxNQUFNLEdBQUcsSUFBSSxHQUFHLE1BQU0sQ0FDdkIsQ0FBQztJQUNKLENBQUM7Q0FFRixDQUFBO0FBckhVO0lBQVIsS0FBSyxFQUFFO3VEQUE4QjtBQUM3QjtJQUFSLEtBQUssRUFBRTsrREFBMEM7QUFGdkMsd0JBQXdCO0lBTHBDLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxtQkFBbUI7UUFDN0Isa3BDQUE4Qzs7S0FFL0MsQ0FBQztHQUNXLHdCQUF3QixDQXNIcEM7U0F0SFksd0JBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBHQ3VycmVuY3lGaWVsZCB9IGZyb20gJy4uLy4uL2dzLWZvcm1zLndpZGdldHMnO1xuaW1wb3J0IHsgR0ZpZWxkVmFsaWRhdG9yVHlwZSwgR0ZpZWxkQ291bnRyeUNvZGUgfSBmcm9tICcuLi8uLi9ncy1mb3Jtcy5lbnVtcyc7XG5pbXBvcnQgeyBMT0NBVElPTiB9IGZyb20gJy4uLy4uL2dzLWZvcm1zLmNvbnN0YW50cyc7XG5pbXBvcnQgeyBHc0dlbmVyaWNGaWVsZENvbXBvbmVudCB9IGZyb20gJy4uL19nZW5lcmljLWZpZWxkL19nZW5lcmljLWZpZWxkLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2dzLWN1cnJlbmN5LWlucHV0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2N1cnJlbmN5LWlucHV0LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vY3VycmVuY3ktaW5wdXQuY29tcG9uZW50LnNhc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBHc0N1cnJlbmN5SW5wdXRDb21wb25lbnQgZXh0ZW5kcyBHc0dlbmVyaWNGaWVsZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG4gIEBJbnB1dCgpIHB1YmxpYyBmaWVsZDogR0N1cnJlbmN5RmllbGQ7XG4gIEBJbnB1dCgpIHByaXZhdGUgY291bnRyeUdsb2JhbDogR0ZpZWxkQ291bnRyeUNvZGU7XG5cbiAgcHVibGljIHBhdHRlcm46IHN0cmluZyB8IFJlZ0V4cDtcbiAgcHVibGljIHByZWZpeDogc3RyaW5nO1xuICBwdWJsaWMgc3VmZml4OiBzdHJpbmc7XG4gIHB1YmxpYyB2YWx1ZSA9ICcnO1xuXG4gIHByaXZhdGUgdGhvdXNhbmRzU2VwYXJhdG9yOiBzdHJpbmc7XG4gIHByaXZhdGUgZGVjaW1hbFNlcGFyYXRvcjogc3RyaW5nO1xuICBwcml2YXRlIHByZWNpc2lvbjogbnVtYmVyO1xuXG4gIHB1YmxpYyBmaWVsZFZhbGlkYXRvclR5cGUgPSBHRmllbGRWYWxpZGF0b3JUeXBlO1xuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBsZXQgbG9jYXRpb24gPSBudWxsO1xuXG4gICAgaWYgKGNoYW5nZXMuZmllbGQgJiYgY2hhbmdlcy5maWVsZC5jdXJyZW50VmFsdWUuY29uZmlnLmNvdW50cnkpIHtcbiAgICAgIGxvY2F0aW9uID0gTE9DQVRJT05bY2hhbmdlcy5maWVsZC5jdXJyZW50VmFsdWUuY29uZmlnLmNvdW50cnldO1xuXG4gICAgfSBlbHNlIGlmIChjaGFuZ2VzLmNvdW50cnlHbG9iYWwgJiYgY2hhbmdlcy5jb3VudHJ5R2xvYmFsLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgbG9jYXRpb24gPSBMT0NBVElPTltjaGFuZ2VzLmNvdW50cnlHbG9iYWwuY3VycmVudFZhbHVlXTtcblxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5yZXR1cm5CdWlsZGluZ0Vycm9yKCk7XG4gICAgfVxuXG4gICAgdGhpcy5wcmVmaXggPSBsb2NhdGlvbi5jdXJyZW5jeUZvcm1hdC5zeW1ib2w7XG4gICAgdGhpcy5zdWZmaXggPSBsb2NhdGlvbi5jdXJyZW5jeUZvcm1hdC5jb2RlO1xuICAgIHRoaXMudGhvdXNhbmRzU2VwYXJhdG9yID0gbG9jYXRpb24uY3VycmVuY3lGb3JtYXQudGhvdXNhbmRzO1xuICAgIHRoaXMuZGVjaW1hbFNlcGFyYXRvciA9IGxvY2F0aW9uLmN1cnJlbmN5Rm9ybWF0LmRlY2ltYWw7XG4gICAgdGhpcy5wcmVjaXNpb24gPSBsb2NhdGlvbi5jdXJyZW5jeUZvcm1hdC5wcmVjaXNpb247XG5cbiAgICBpZiAoY2hhbmdlcy5maWVsZC5jdXJyZW50VmFsdWUuY29uZmlnLnZhbHVlKSB7XG4gICAgICB0aGlzLnZhbHVlID0gY2hhbmdlcy5maWVsZC5jdXJyZW50VmFsdWUuY29uZmlnLnZhbHVlLnRvU3RyaW5nKCkucmVwbGFjZSgnLicsICcnKTtcbiAgICB9XG5cbiAgICB0aGlzLmZvcm1hdEN1cnJlbmN5KGZhbHNlKTtcbiAgfVxuXG4gIHB1YmxpYyBmb3JtYXRDdXJyZW5jeShrZXl1cDogYm9vbGVhbikge1xuICAgIGxldCBpbnB1dFZhbCA9IHRoaXMudmFsdWUgfHwgJzAnO1xuXG4gICAgLy8gbWFyayBpbnB1dCBhcyBkaXJ0eVxuICAgIGlmIChrZXl1cCkge1xuICAgICAgdGhpcy5mb3JtR3JvdXAuY29udHJvbHNbdGhpcy5maWVsZC5jb25maWcubW9kZWxdLm1hcmtBc0RpcnR5KCk7XG4gICAgfVxuXG4gICAgLy8gcmVtb3ZlIGFueSBsZWFkaW5nIHplcm9zXG4gICAgaWYgKGlucHV0VmFsLnN1YnN0cmluZygwLCAxKSA9PT0gJzAnKSB7XG4gICAgICBpbnB1dFZhbCA9IGlucHV0VmFsLnJlcGxhY2UoL15bMHxcXERdKi8sICcnKTtcbiAgICB9XG5cbiAgICAvLyBmb3JtYXQgZGVjaW1hbCBpZiBhcHBsaWVzXG4gICAgaWYgKCFpbnB1dFZhbCB8fCBpbnB1dFZhbC5sZW5ndGggPT09IDEgJiYgaW5wdXRWYWwuc3Vic3RyaW5nKDAsIDEpID09PSAnMCcpIHtcbiAgICAgIGxldCBlbXB0eURlY2ltYWxzID0gJzAnO1xuXG4gICAgICBpZiAodGhpcy5wcmVjaXNpb24gPiAwKSB7XG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLnByZWNpc2lvbjsgaW5kZXgrKykge1xuICAgICAgICAgIGVtcHR5RGVjaW1hbHMgPSBlbXB0eURlY2ltYWxzICsgJzAnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpbnB1dFZhbCA9IGVtcHR5RGVjaW1hbHM7XG4gICAgfVxuXG4gICAgY29uc3QgY2xlYW5WYWx1ZSA9IGlucHV0VmFsLnJlcGxhY2UoL1xcRC9nLCAnJyk7XG5cbiAgICBsZXQgZGVjaW1hbHMgPSBudWxsO1xuICAgIGxldCB0aG91c2FuZHMgPSBudWxsO1xuXG4gICAgLy8gZm9ybWF0IG51bWJlciBhcyBjdXJyZW5jeVxuICAgIGlmICh0aGlzLnByZWNpc2lvbiA+IDApIHtcbiAgICAgIGRlY2ltYWxzID0gY2xlYW5WYWx1ZS5zbGljZSh0aGlzLnByZWNpc2lvbiAtIHRoaXMucHJlY2lzaW9uICogMik7XG5cbiAgICAgIGlmIChkZWNpbWFscy5sZW5ndGggPCB0aGlzLnByZWNpc2lvbikge1xuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5wcmVjaXNpb24gLSBOdW1iZXIoZGVjaW1hbHMpOyBpbmRleCsrKSB7XG4gICAgICAgICAgZGVjaW1hbHMgPSAnMCcgKyBkZWNpbWFscztcbiAgICAgICAgfVxuICAgICAgICB0aG91c2FuZHMgPSAnMCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aG91c2FuZHMgPSBjbGVhblZhbHVlLnN1YnN0cmluZygwLCBjbGVhblZhbHVlLmxlbmd0aCAtIHRoaXMucHJlY2lzaW9uKSB8fCAnMCc7XG4gICAgICB9XG5cbiAgICB9IGVsc2Uge1xuICAgICAgdGhvdXNhbmRzID0gY2xlYW5WYWx1ZTtcbiAgICB9XG5cbiAgICBjb25zdCBmb3JtYXR0ZWRUaG91c2FuZHMgPSB0aG91c2FuZHMucmVwbGFjZSgvXFxEL2csICcnKS5yZXBsYWNlKC9cXEIoPz0oXFxkezN9KSsoPyFcXGQpKS9nLCB0aGlzLnRob3VzYW5kc1NlcGFyYXRvcik7XG4gICAgY29uc3QgY29udHJvbFZhbHVlID0gYCR7dGhvdXNhbmRzfSR7ZGVjaW1hbHMgPyAnLicgKyBkZWNpbWFscyA6ICcnfWA7XG5cbiAgICB0aGlzLnZhbHVlID0gZm9ybWF0dGVkVGhvdXNhbmRzICsgKGRlY2ltYWxzID8gdGhpcy5kZWNpbWFsU2VwYXJhdG9yICsgZGVjaW1hbHMgOiAnJyk7XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzW3RoaXMuZmllbGQuY29uZmlnLm1vZGVsXS5wYXRjaFZhbHVlKE51bWJlcihjb250cm9sVmFsdWUpKTtcbiAgICAgIHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzW3RoaXMuZmllbGQuY29uZmlnLm1vZGVsXS51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KCk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgcmV0dXJuQnVpbGRpbmdFcnJvcigpIHtcbiAgICByZXR1cm4gY29uc29sZS5lcnJvcihcbiAgICAgICdHUyBGb3JtIGJ1aWxkaW5nIGVycjogUGxlYXNlIHByb3ZpZGUgY291bnRyeSBmb3IgY3VycmVuY3kgZmllbGQ6JyArICdcXG5cXG4nICtcbiAgICAgICdJbiB5b3VyIGNvbXBvbmVudCBtYWtlIHN1cmUgeW91IGFyZSBwYXNzaW5nIGEgdmFsaWQgY291bnRyeSB0byBgR0N1cnJlbmN5RmllbGRgOicgKyAnXFxuXFxuJyArXG4gICAgICAnXFx4YTAnICsgJ3B1YmxpYyBmb3JtRmllbGRzOiBHRm9ybUZpZWxkcyA9IFsnICsgJ1xcbicgK1xuICAgICAgJ1xceGEwXFx4YTAnICsgJ25ldyBHQ3VycmVuY3lGaWVsZCh7JyArICdcXG4nICtcbiAgICAgICdcXHhhMFxceGEwXFx4YTAnICsgYG1vZGVsOiAnY3VycmVuY3knLGAgKyAnXFxuJyArXG4gICAgICAnXFx4YTBcXHhhMFxceGEwJyArIGBjb3VudHJ5OiBHRmllbGRDb3VudHJ5Q29kZS5DT2AgKyAnXFxuJyArXG4gICAgICAnXFx4YTBcXHhhMFxceGEwJyArICcvLyBvdGhlciBwcm9wZXJ0aWVzJyArICdcXG4nICtcbiAgICAgICdcXHhhMFxceGEwJyArICd9KSwnICsgJ1xcbicgK1xuICAgICAgJ1xceGEwJyArICddOycgKyAnXFxuXFxuJyArXG4gICAgICAnT3IgSW4geW91ciBjb21wb25lbnQgbWFrZSBzdXJlIHlvdSBhcmUgcGFzc2luZyBhIHZhbGlkIGNvdW50cnkgdG8gYEdGb3JtT3B0aW9uc2A6JyArICdcXG5cXG4nICtcbiAgICAgICdcXHhhMCcgKyAncHVibGljIGZvcm1PcHRpb25zOiBHRm9ybU9wdGlvbnMgPSB7JyArICdcXG4nICtcbiAgICAgICdcXHhhMFxceGEwJyArICdjb3VudHJ5OiBHRmllbGRDb3VudHJ5Q29kZS5DTycgKyAnXFxuJyArXG4gICAgICAnXFx4YTBcXHhhMCcgKyAnLy8gb3RoZXIgcHJvcGVydGllcycgKyAnXFxuJyArXG4gICAgICAnXFx4YTAnICsgJ307JyArICdcXG5cXG4nXG4gICAgKTtcbiAgfVxuXG59XG4iXX0=